# RailwayReform - 列车无人驾驶系统
**需要机械动力0.5.1j和汽鸣铁道作为前置**

本项目为Minecraft模组，基于机械动力(Create)和汽鸣铁道(Steam 'n' Rails)实现列车自动驾驶功能。

## 功能特性

- **无需设置站点**: 列车将持续沿轨道自动前行
- **道岔检测**: 前方出现道岔时自动停止，避免脱轨
- **一键切换**: 按H键快速切换自动驾驶状态
- **速度控制**: 自动驾驶模式下自动提速到最大速度
- **手动接管**: 行驶中可随时切换为手动驾驶
- **双模组支持**: 同时支持机械动力和汽鸣铁道列车

## 使用方法
### 启用自动驾驶
1. 进入列车驾驶位或靠近列车
2. 按 **H键** 打开列车控制设置界面
3. 选择驾驶模式：手动驾驶、半自动驾驶、全自动驾驶
4. 选择行驶方向：停止、前进、后退、自动
5. 设置速度限制：0.2-1.5之间的多个档位
6. 点击确认应用设置

### 紧急制动
- 在列车控制设置界面中点击**紧急制动**按钮
- 紧急制动会立即停止列车并清除自动驾驶状态
- 列车将切换到手动驾驶模式，速度设为0

### 驾驶员退出保护
当自动驾驶的发起者退出游戏时，系统会自动触发紧急制动：
- 自动检测发起自动驾驶的玩家
- 当该玩家退出游戏时，立即对其控制的列车执行紧急制动
- 确保列车不会因玩家离线而失控
- 向所有在线玩家广播紧急制动消息

### 配置选项
在配置文件中可调整以下参数：
- `autoDriveKey`: 自动驾驶切换键位（默认: H）
- `maxAutoSpeed`: 最大自动驾驶速度（0.0-1.0，默认: 0.8）
- `switchDetectRange`: 道岔检测范围（默认: 10格）

## 技术实现

### 核心组件
- `AutoDriveHandler`: 自动驾驶状态管理
- `TrainSettingsScreen`: 列车控制设置GUI
- `AutoDriveSettingsPacket`: 详细设置网络通信
- `SteamNRailsIntegration`: 汽鸣铁道集成
- `CreateIntegration`: 机械动力集成
- `KeyInputHandler`: 键位输入处理

### 工作流程
1. 玩家按H键打开TrainSettingsScreen GUI
2. 在GUI中选择驾驶模式、方向和速度
3. 确认后发送AutoDriveSettingsPacket到服务器
4. 服务端AutoDriveHandler应用详细设置
5. 根据列车类型调用对应模组的集成逻辑
6. 持续检测前方道岔并调整速度

## 注意事项

- 确保已安装机械动力或汽鸣铁道模组
- 自动驾驶状态下请勿离开驾驶位
- 道岔停止后需手动操作通过道岔
- 建议在直线轨道上测试功能

## 开发信息

- 主类: `cn.kafei.railwayreform.RailwayReformMod`
- 配置文件: `config/railwayreform-common.toml`
- 网络通信: Forge网络系统

## 版本历史

### v1.1.2
- 优化GUI界面交互体验
- 手动驾驶模式时锁定其他选项按钮
- 全自动驾驶模式时锁定限速按钮
- 将速度限制改为滑动条，支持0-2.0范围调节
- 行驶速度优化：半自动驾驶模式使用用户设置的精确速度值
- 提升用户操作直观性
- 修复配置加载错误：解决重复变量声明导致的崩溃问题

### v1.1.1
- 修复列车无法后退的问题
- 优化方向控制逻辑，支持前进和后退模式
- 改进列车速度控制，根据方向设置正负速度值

### v1.1.0
- 新增列车控制设置GUI
- 支持三种驾驶模式：手动、半自动、全自动
- 支持四种行驶方向：停止、前进、后退、自动
- 支持多档位速度限制设置
- 设置记忆功能，保留上次选择

### v1.0.0
- 初始版本发布
- 支持机械动力和汽鸣铁道
- 基本自动驾驶功能实现
- 道岔检测和停止功能
